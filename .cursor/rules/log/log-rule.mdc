# é™¤éŒ¯æ—¥èªŒè¦ç¯„

## ğŸ“‹ æ¦‚è¿°

æœ¬æ–‡ä»¶å®šç¾©äº† PM25 æ‡‰ç”¨ç¨‹å¼çš„é™¤éŒ¯æ—¥èªŒä½¿ç”¨è¦ç¯„ï¼Œç¢ºä¿é–‹ç™¼éç¨‹ä¸­èƒ½å¤ æœ‰æ•ˆè¿½è¹¤å•é¡Œã€ç›£æ§æ‡‰ç”¨ç¨‹å¼ç‹€æ…‹ï¼Œä¸¦æä¾›æ¸…æ™°çš„é™¤éŒ¯è³‡è¨Šã€‚

**æ ¸å¿ƒåŸå‰‡ï¼š**
- ä¾ç…§æƒ…æ³é¸æ“‡ "pm25_app/lib/core/loggers"ä¸­çš„æª”æ¡ˆé€²è¡Œé™¤éŒ¯
- ä½¿ç”¨çµ±ä¸€çš„ `AppLogger` é€²è¡Œæ—¥èªŒè¨˜éŒ„
- ç°¡çŸ­æè¿°å•é¡Œï¼Œä¾¿æ–¼å¿«é€Ÿå®šä½
- é©ç•¶ä½¿ç”¨æ—¥èªŒå±¤ç´šï¼Œé¿å…éåº¦è¨˜éŒ„
- æ”¯æ´é–‹ç™¼å’Œç”Ÿç”¢ç’°å¢ƒçš„ä¸åŒæ—¥èªŒç­–ç•¥

## ğŸ¯ æ—¥èªŒç³»çµ±æ¶æ§‹

### 1. æ—¥èªŒå±¤ç´šå®šç¾©

```dart
// ä½¿ç”¨ AppLogger é€²è¡Œçµ±ä¸€æ—¥èªŒç®¡ç†
class AppLogger {
  // å¿«æ·æ–¹æ³•
  void d(Object? msg) => _logger.fine(msg);      // DEBUG
  void i(Object? msg) => _logger.info(msg);      // INFO  
  void w(Object? msg) => _logger.warning(msg);   // WARNING
  void e(Object? msg, [Object? err, StackTrace? st]) => _logger.severe(msg, err, st); // ERROR
}
```

### 2. æ—¥èªŒå±¤ç´šä½¿ç”¨æŒ‡å—

| å±¤ç´š | ä½¿ç”¨å ´æ™¯ | ç¯„ä¾‹ |
|------|----------|------|
| **DEBUG** | è©³ç´°çš„é™¤éŒ¯è³‡è¨Šï¼Œåƒ…é–‹ç™¼ç’°å¢ƒ | `log.d('API è«‹æ±‚åƒæ•¸: $params')` |
| **INFO** | ä¸€èˆ¬è³‡è¨Šï¼Œè¨˜éŒ„é‡è¦æ“ä½œ | `log.i('ç”¨æˆ¶ç™»å…¥æˆåŠŸ: ${user.email}')` |
| **WARNING** | è­¦å‘Šè³‡è¨Šï¼Œå¯èƒ½å½±éŸ¿åŠŸèƒ½ | `log.w('ç¶²è·¯é€£ç·šç·©æ…¢ï¼Œé‡è©¦ä¸­...')` |
| **ERROR** | éŒ¯èª¤è³‡è¨Šï¼Œéœ€è¦é—œæ³¨ | `log.e('API è«‹æ±‚å¤±æ•—', error, stackTrace)` |

## ğŸ“ æ—¥èªŒä½¿ç”¨è¦ç¯„

### 1. åŸºæœ¬ä½¿ç”¨åŸå‰‡

```dart
// âœ… æ­£ç¢ºï¼šä½¿ç”¨ AppLogger é€²è¡Œæ—¥èªŒè¨˜éŒ„
class DataService {
  final log = AppLogger('DataService');
  
  Future<void> fetchData() async {
    try {
      log.i('é–‹å§‹ç²å–è³‡æ–™');
      // å¯¦ä½œé‚è¼¯
      log.i('è³‡æ–™ç²å–æˆåŠŸ: ${data.length} ç­†');
    } catch (e, stack) {
      log.e('è³‡æ–™ç²å–å¤±æ•—', e, stack);
    }
  }
}
```

### 2. æ—¥èªŒå‘½åè¦ç¯„

```dart
// âœ… æ­£ç¢ºï¼šä½¿ç”¨æœ‰æ„ç¾©çš„ Logger åç¨±
final log = AppLogger('AuthService');        // èªè­‰æœå‹™
final log = AppLogger('AQIProvider');        // AQI æä¾›è€…
final log = AppLogger('NewsRepository');     // æ–°èå„²å­˜åº«
final log = AppLogger('HomeScreen');         // é¦–é ç•«é¢

// âŒ éŒ¯èª¤ï¼šé¿å…ä½¿ç”¨ç„¡æ„ç¾©çš„åç¨±
final log = AppLogger('test');
final log = AppLogger('123');
```

### 3. æ—¥èªŒå…§å®¹è¦ç¯„

#### 3.1 è¨Šæ¯æ ¼å¼
```dart
// âœ… æ­£ç¢ºï¼šç°¡æ½”æ˜ç­çš„è¨Šæ¯
log.i('ç”¨æˆ¶ç™»å…¥æˆåŠŸ');
log.w('ç¶²è·¯é€£ç·šè¶…æ™‚ï¼Œé‡è©¦ä¸­...');
log.e('API è«‹æ±‚å¤±æ•—: 401 Unauthorized');

// âŒ éŒ¯èª¤ï¼šéæ–¼å†—é•·æˆ–ç„¡æ„ç¾©çš„è¨Šæ¯
log.i('é€™æ˜¯ä¸€å€‹éå¸¸é•·çš„æ—¥èªŒè¨Šæ¯ï¼ŒåŒ…å«äº†å¤ªå¤šä¸å¿…è¦çš„è³‡è¨Š...');
log.d('test');
```

#### 3.2 è®Šæ•¸è¨˜éŒ„
```dart
// âœ… æ­£ç¢ºï¼šè¨˜éŒ„é—œéµè®Šæ•¸
log.i('è¼‰å…¥ç”¨æˆ¶è³‡æ–™: ${user.id}');
log.d('API åƒæ•¸: $params');
log.w('é‡è©¦æ¬¡æ•¸: $retryCount');

// âœ… æ­£ç¢ºï¼šä½¿ç”¨çµæ§‹åŒ–è¨˜éŒ„
log.i('è³‡æ–™è¼‰å…¥å®Œæˆ', {
  'count': data.length,
  'timestamp': DateTime.now().toIso8601String(),
  'source': 'cache'
});
```

### 4. éŒ¯èª¤æ—¥èªŒè¦ç¯„

#### 4.1 ç•°å¸¸è™•ç†
```dart
// âœ… æ­£ç¢ºï¼šå®Œæ•´çš„éŒ¯èª¤è¨˜éŒ„
try {
  await apiService.fetchData();
} catch (e, stack) {
  log.e('API è«‹æ±‚å¤±æ•—', e, stack);
  // è™•ç†éŒ¯èª¤
}

// âœ… æ­£ç¢ºï¼šåŒ…å«ä¸Šä¸‹æ–‡è³‡è¨Š
try {
  final result = await apiService.fetchAQIData(siteId);
  log.i('AQI è³‡æ–™ç²å–æˆåŠŸ: ${result.length} ç­†');
} catch (e, stack) {
  log.e('AQI è³‡æ–™ç²å–å¤±æ•— - ç«™é»ID: $siteId', e, stack);
  rethrow;
}
```

#### 4.2 éŒ¯èª¤åˆ†é¡
```dart
// ç¶²è·¯éŒ¯èª¤
log.e('ç¶²è·¯é€£ç·šå¤±æ•—', error, stackTrace);

// è³‡æ–™è§£æéŒ¯èª¤
log.e('JSON è§£æå¤±æ•—', error, stackTrace);

// èªè­‰éŒ¯èª¤
log.e('ç”¨æˆ¶èªè­‰å¤±æ•—', error, stackTrace);

// æ¥­å‹™é‚è¼¯éŒ¯èª¤
log.e('è³‡æ–™é©—è­‰å¤±æ•—', error, stackTrace);
```

## ğŸ”§ é™¤éŒ¯æŠ€å·§

### 1. æ–¹æ³•é€²å…¥/é€€å‡ºè¿½è¹¤

```dart
class DataService {
  final log = AppLogger('DataService');
  
  Future<List<AQIRecord>> fetchRecentData() async {
    log.d('é€²å…¥ fetchRecentData æ–¹æ³•');
    
    try {
      final data = await _fetchFromAPI();
      log.d('fetchRecentData å®Œæˆï¼Œè¿”å› ${data.length} ç­†è³‡æ–™');
      return data;
    } catch (e, stack) {
      log.e('fetchRecentData å¤±æ•—', e, stack);
      rethrow;
    }
  }
}
```

### 2. ç‹€æ…‹è®Šæ›´è¿½è¹¤

```dart
class AQIProvider extends ChangeNotifier {
  final log = AppLogger('AQIProvider');
  
  void updateAQIData(List<AQIRecord> newData) {
    log.d('ç‹€æ…‹æ›´æ–°: ${_data.length} -> ${newData.length} ç­†è³‡æ–™');
    _data = newData;
    notifyListeners();
    log.i('AQI è³‡æ–™å·²æ›´æ–°ä¸¦é€šçŸ¥ç›£è½è€…');
  }
}
```

### 3. æ•ˆèƒ½ç›£æ§

```dart
class PerformanceLogger {
  final log = AppLogger('Performance');
  
  Future<T> measureTime<T>(String operation, Future<T> Function() task) async {
    final stopwatch = Stopwatch()..start();
    
    try {
      final result = await task();
      stopwatch.stop();
      log.i('$operation å®Œæˆï¼Œè€—æ™‚: ${stopwatch.elapsedMilliseconds}ms');
      return result;
    } catch (e, stack) {
      stopwatch.stop();
      log.e('$operation å¤±æ•—ï¼Œè€—æ™‚: ${stopwatch.elapsedMilliseconds}ms', e, stack);
      rethrow;
    }
  }
}
```

## ğŸ¨ æ—¥èªŒæ ¼å¼ç¯„ä¾‹

### 1. æ¨™æº–æ—¥èªŒæ ¼å¼

```
[INFO] 14:30:25.123 DataService: é–‹å§‹ç²å– AQI è³‡æ–™
[DEBUG] 14:30:25.124 DataService: API è«‹æ±‚åƒæ•¸: {"siteId": "001"}
[INFO] 14:30:25.456 DataService: AQI è³‡æ–™ç²å–æˆåŠŸ: 24 ç­†
[WARNING] 14:30:25.457 DataService: ç¶²è·¯é€£ç·šç·©æ…¢ï¼Œé‡è©¦ä¸­...
[ERROR] 14:30:25.789 DataService: API è«‹æ±‚å¤±æ•—: 500 Internal Server Error
```

### 2. éŒ¯èª¤æ—¥èªŒæ ¼å¼

```
[ERROR] 14:30:25.789 DataService: API è«‹æ±‚å¤±æ•—
Exception: HttpException: 500 Internal Server Error
Stack Trace:
#0 _rootRunUnary (dart:async/zone.dart:1362:47)
#1 _CustomZone.runUnary (dart:async/zone.dart:1265:19)
#2 _FutureListener.handleValue (dart:async/future_impl.dart:131:9)
```

## ğŸš€ æœ€ä½³å¯¦è¸

### 1. æ—¥èªŒå±¤ç´šé¸æ“‡

```dart
// âœ… æ­£ç¢ºï¼šæ ¹æ“šé‡è¦æ€§é¸æ“‡é©ç•¶å±¤ç´š
log.d('è©³ç´°çš„é™¤éŒ¯è³‡è¨Š');           // åƒ…é–‹ç™¼ç’°å¢ƒ
log.i('é‡è¦çš„æ¥­å‹™æ“ä½œ');           // æ‰€æœ‰ç’°å¢ƒ
log.w('éœ€è¦æ³¨æ„çš„è­¦å‘Š');           // æ‰€æœ‰ç’°å¢ƒ
log.e('éœ€è¦ç«‹å³è™•ç†çš„éŒ¯èª¤');       // æ‰€æœ‰ç’°å¢ƒ
```

### 2. é¿å…éåº¦è¨˜éŒ„

```dart
// âŒ éŒ¯èª¤ï¼šéåº¦è¨˜éŒ„
for (int i = 0; i < 1000; i++) {
  log.d('è™•ç†ç¬¬ $i å€‹é …ç›®');  // æœƒç”¢ç”Ÿå¤§é‡æ—¥èªŒ
}

// âœ… æ­£ç¢ºï¼šé©ç•¶è¨˜éŒ„
for (int i = 0; i < 1000; i++) {
  if (i % 100 == 0) {
    log.d('å·²è™•ç† $i å€‹é …ç›®');  // æ¯ 100 å€‹è¨˜éŒ„ä¸€æ¬¡
  }
  // è™•ç†é‚è¼¯
}
log.i('æ‰¹é‡è™•ç†å®Œæˆ: 1000 å€‹é …ç›®');
```

### 3. æ•æ„Ÿè³‡è¨Šè™•ç†

```dart
// âŒ éŒ¯èª¤ï¼šè¨˜éŒ„æ•æ„Ÿè³‡è¨Š
log.i('ç”¨æˆ¶å¯†ç¢¼: $password');
log.d('API é‡‘é‘°: $apiKey');

// âœ… æ­£ç¢ºï¼šé®è”½æ•æ„Ÿè³‡è¨Š
log.i('ç”¨æˆ¶ç™»å…¥: ${user.email}');
log.d('API è«‹æ±‚: ${apiKey.substring(0, 8)}...');
```

## ğŸ” é™¤éŒ¯å·¥å…·

### 1. å…¨åŸŸéŒ¯èª¤è™•ç†

```dart
// åœ¨ main.dart ä¸­è¨­ç½®
void main() {
  AppLogger.init();
  setupGlobalErrorHandlers();
  runApp(MyApp());
}

// å…¨åŸŸéŒ¯èª¤è™•ç†
void setupGlobalErrorHandlers() {
  final log = AppLogger('GlobalError');
  
  FlutterError.onError = (FlutterErrorDetails details) {
    log.e('æœªè™•ç†çš„ Flutter éŒ¯èª¤', details.exception, details.stack);
  };
}
```

### 2. æ•ˆèƒ½ç›£æ§å·¥å…·

```dart
class DebugTools {
  static final log = AppLogger('DebugTools');
  
  static void logMemoryUsage() {
    log.i('è¨˜æ†¶é«”ä½¿ç”¨æƒ…æ³: ${ProcessInfo.currentRss} bytes');
  }
  
  static void logWidgetRebuild(String widgetName) {
    log.d('Widget é‡å»º: $widgetName');
  }
}
```

## ğŸ“Š æ—¥èªŒåˆ†æ

### 1. å¸¸è¦‹éŒ¯èª¤æ¨¡å¼

```dart
// ç¶²è·¯éŒ¯èª¤æ¨¡å¼
log.e('ç¶²è·¯é€£ç·šå¤±æ•—', error, stackTrace);

// è³‡æ–™è§£æéŒ¯èª¤æ¨¡å¼
log.e('JSON è§£æå¤±æ•—', error, stackTrace);

// ç‹€æ…‹ç®¡ç†éŒ¯èª¤æ¨¡å¼
log.e('Provider ç‹€æ…‹æ›´æ–°å¤±æ•—', error, stackTrace);
```

### 2. æ•ˆèƒ½ç“¶é ¸è­˜åˆ¥

```dart
// è­˜åˆ¥æ…¢æ“ä½œ
log.i('è³‡æ–™åº«æŸ¥è©¢é–‹å§‹');
// ... æŸ¥è©¢æ“ä½œ
log.i('è³‡æ–™åº«æŸ¥è©¢å®Œæˆï¼Œè€—æ™‚: ${stopwatch.elapsedMilliseconds}ms');
```

## ğŸ¯ æª¢æŸ¥æ¸…å–®

### é–‹ç™¼å‰
- [ ] ç¢ºèªæ—¥èªŒç³»çµ±å·²åˆå§‹åŒ–
- [ ] é¸æ“‡é©ç•¶çš„ Logger åç¨±
- [ ] è¦åŠƒæ—¥èªŒå±¤ç´šä½¿ç”¨ç­–ç•¥

### é–‹ç™¼ä¸­
- [ ] åœ¨é—œéµæ–¹æ³•ä¸­åŠ å…¥æ—¥èªŒ
- [ ] è¨˜éŒ„é‡è¦çš„ç‹€æ…‹è®Šæ›´
- [ ] é©ç•¶è™•ç†ç•°å¸¸ä¸¦è¨˜éŒ„éŒ¯èª¤
- [ ] é¿å…è¨˜éŒ„æ•æ„Ÿè³‡è¨Š

### é–‹ç™¼å¾Œ
- [ ] æª¢æŸ¥æ—¥èªŒè¼¸å‡ºæ˜¯å¦æ¸…æ™°
- [ ] ç¢ºèªéŒ¯èª¤æ—¥èªŒåŒ…å«è¶³å¤ è³‡è¨Š
- [ ] é©—è­‰æ—¥èªŒä¸æœƒå½±éŸ¿æ•ˆèƒ½
- [ ] æ¸¬è©¦ä¸åŒç’°å¢ƒçš„æ—¥èªŒè¡Œç‚º

## ğŸ“š ç›¸é—œæ–‡ä»¶

- **æ—¥èªŒç³»çµ±å¯¦ä½œ**: `lib/core/loggers/log.dart`
- **éŒ¯èª¤è™•ç†**: `lib/core/loggers/error_handler.dart`
- **å…¨åŸŸéŒ¯èª¤è™•ç†**: `lib/main.dart`

---

**æœ€å¾Œæ›´æ–°**: 2025å¹´08æœˆ  
**ç‰ˆæœ¬**: 1.0.0  
**é©ç”¨ç¯„åœ**: PM25 æ‡‰ç”¨ç¨‹å¼é™¤éŒ¯æ—¥èªŒè¦ç¯„ 


alwaysApply: true
---
if need to use debug print, use [log.dart](mdc:lib/core/loggers/log.dart) 

