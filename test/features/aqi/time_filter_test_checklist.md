# AQI 時間過濾功能測試檢查清單

## 📋 測試概述

本文件提供 AQI 時間過濾功能的完整測試檢查清單，確保功能的正確性、效能和品質。

## 🧪 測試分類

### 1. 單元測試 (Unit Tests)

#### 1.1 核心邏輯測試
- [ ] **TimeFilterOption 枚舉測試**
  - [ ] 所有枚舉值正確定義
  - [ ] label 屬性正確
  - [ ] duration 屬性正確
  - [ ] timeRangeDescription 方法正確

- [ ] **過濾邏輯測試**
  - [ ] 1小時過濾模式正確過濾資料
  - [ ] 3小時過濾模式正確過濾資料
  - [ ] 6小時過濾模式正確過濾資料
  - [ ] 12小時過濾模式正確過濾資料
  - [ ] 24小時過濾模式正確過濾資料
  - [ ] 全部資料模式顯示所有資料

- [ ] **狀態管理測試**
  - [ ] 預設狀態為 3小時
  - [ ] setTimeFilter 方法正確更新狀態
  - [ ] 狀態變更時正確通知監聽者
  - [ ] 相同選項不會重複觸發更新

#### 1.2 邊界條件測試
- [ ] **空資料測試**
  - [ ] 空資料列表的過濾行為
  - [ ] 空資料時的錯誤處理

- [ ] **時間邊界測試**
  - [ ] 剛好在過濾時間邊界的資料
  - [ ] 超過過濾時間的資料
  - [ ] 未來時間的資料處理

- [ ] **異常情況測試**
  - [ ] 無效的時間資料處理
  - [ ] 過濾過程中的異常處理
  - [ ] 記憶體不足時的處理

#### 1.3 效能測試
- [ ] **過濾效能測試**
  - [ ] 1000筆資料的過濾時間 < 100ms
  - [ ] 10000筆資料的過濾時間 < 500ms
  - [ ] 大量資料的記憶體使用合理

- [ ] **記憶體使用測試**
  - [ ] 多次過濾操作的記憶體使用
  - [ ] 長時間運行的記憶體洩漏檢查
  - [ ] 垃圾回收後的記憶體釋放

### 2. Widget 測試 (Widget Tests)

#### 2.1 UI 渲染測試
- [ ] **導航欄按鈕測試**
  - [ ] 按鈕正確顯示當前選項
  - [ ] 按鈕圖示正確顯示
  - [ ] 按鈕文字正確顯示

- [ ] **時間選擇器測試**
  - [ ] 選擇器正確彈出
  - [ ] 所有選項正確顯示
  - [ ] 當前選項正確標記

- [ ] **資料列表測試**
  - [ ] 資料卡片正確渲染
  - [ ] 資料數量正確顯示
  - [ ] 時間範圍正確顯示

#### 2.2 互動測試
- [ ] **按鈕點擊測試**
  - [ ] 點擊按鈕顯示選擇器
  - [ ] 點擊取消按鈕關閉選擇器
  - [ ] 點擊背景關閉選擇器

- [ ] **選項選擇測試**
  - [ ] 選擇不同時間範圍
  - [ ] 選擇後按鈕文字更新
  - [ ] 選擇後資料列表更新

- [ ] **狀態同步測試**
  - [ ] UI 狀態與 Provider 狀態同步
  - [ ] 多個組件狀態一致
  - [ ] 狀態變更時正確更新

### 3. 整合測試 (Integration Tests)

#### 3.1 完整流程測試
- [ ] **基本流程測試**
  - [ ] 進入頁面 → 選擇時間範圍 → 查看結果
  - [ ] 切換不同時間範圍的完整流程
  - [ ] 取消選擇的流程

- [ ] **資料載入測試**
  - [ ] 載入資料 → 過濾顯示 → 切換時間範圍
  - [ ] 網路錯誤時的處理流程
  - [ ] 載入中的狀態顯示

#### 3.2 多組件整合測試
- [ ] **Provider 整合測試**
  - [ ] AqiProvider 與 UI 組件整合
  - [ ] 多個 Consumer 組件同步
  - [ ] 狀態變更的傳播機制

- [ ] **頁面整合測試**
  - [ ] AqiDataPage 與 HomeScreen 整合
  - [ ] 導航和返回功能
  - [ ] 頁面狀態保持

### 4. 效能測試 (Performance Tests)

#### 4.1 響應時間測試
- [ ] **UI 響應測試**
  - [ ] 按鈕點擊響應時間 < 50ms
  - [ ] 選擇器彈出時間 < 100ms
  - [ ] 資料列表更新時間 < 200ms

- [ ] **過濾操作測試**
  - [ ] 小量資料過濾時間 < 50ms
  - [ ] 中量資料過濾時間 < 100ms
  - [ ] 大量資料過濾時間 < 500ms

#### 4.2 記憶體測試
- [ ] **記憶體使用測試**
  - [ ] 初始記憶體使用基準
  - [ ] 過濾操作後的記憶體使用
  - [ ] 長時間運行的記憶體趨勢

- [ ] **記憶體洩漏測試**
  - [ ] 多次過濾操作的記憶體檢查
  - [ ] 組件銷毀後的記憶體釋放
  - [ ] 垃圾回收後的記憶體清理

## 🔍 測試執行指南

### 1. 測試環境準備
```bash
# 確保測試環境正確
flutter doctor
flutter pub get
flutter test --coverage
```

### 2. 測試執行順序
1. **單元測試**: 先執行核心邏輯測試
2. **Widget 測試**: 再執行 UI 組件測試
3. **整合測試**: 最後執行完整流程測試
4. **效能測試**: 在最後執行效能相關測試

### 3. 測試執行命令
```bash
# 執行所有測試
flutter test

# 執行特定測試檔案
flutter test test/features/aqi/aqi_provider_time_filter_test.dart

# 執行測試並生成覆蓋率報告
flutter test --coverage
genhtml coverage/lcov.info -o coverage/html
```

### 4. 測試結果驗證
- [ ] 所有測試通過
- [ ] 測試覆蓋率 ≥ 90%
- [ ] 無測試警告或錯誤
- [ ] 效能測試符合要求

## 📊 測試報告模板

### 測試執行報告
```
測試執行時間: [日期時間]
測試環境: [Flutter 版本, Dart 版本]
測試總數: [數量]
通過測試: [數量]
失敗測試: [數量]
測試覆蓋率: [百分比]

詳細結果:
- 單元測試: [通過/失敗] ([數量])
- Widget 測試: [通過/失敗] ([數量])
- 整合測試: [通過/失敗] ([數量])
- 效能測試: [通過/失敗] ([數量])
```

### 效能測試報告
```
過濾效能測試:
- 1000筆資料: [時間]ms (目標: <100ms)
- 10000筆資料: [時間]ms (目標: <500ms)

記憶體使用測試:
- 初始記憶體: [大小]MB
- 過濾後記憶體: [大小]MB
- 記憶體增加: [大小]MB (目標: <10MB)

UI 響應測試:
- 按鈕響應: [時間]ms (目標: <50ms)
- 選擇器彈出: [時間]ms (目標: <100ms)
- 列表更新: [時間]ms (目標: <200ms)
```

## 🚨 常見問題與解決方案

### 1. 測試失敗問題
- **問題**: 測試資料時間設定不正確
- **解決**: 確保測試資料使用正確的時間範圍

- **問題**: Provider 狀態未正確初始化
- **解決**: 在測試中正確設定 Provider 狀態

- **問題**: UI 組件未正確渲染
- **解決**: 確保測試環境包含必要的 Provider 包裝

### 2. 效能問題
- **問題**: 過濾操作過慢
- **解決**: 優化過濾邏輯，使用更高效的演算法

- **問題**: 記憶體使用過高
- **解決**: 檢查是否有記憶體洩漏，優化資料結構

### 3. 測試覆蓋率問題
- **問題**: 測試覆蓋率不足
- **解決**: 增加邊界條件測試和異常情況測試

## 📝 測試維護

### 1. 定期檢查
- [ ] 每週執行完整測試套件
- [ ] 檢查測試覆蓋率變化
- [ ] 更新測試案例以適應新需求

### 2. 測試更新
- [ ] 新增功能時同步更新測試
- [ ] 修改邏輯時更新相關測試
- [ ] 移除功能時清理相關測試

### 3. 測試優化
- [ ] 優化測試執行時間
- [ ] 減少測試重複代碼
- [ ] 提高測試可讀性

---

**文件版本**: 1.0.0  
**最後更新**: 2025年1月  
**適用範圍**: AQI 時間過濾功能測試  
**參考文件**: timefilter.md, RULES.md
