# AQI 功能測試說明

## 最近3小時測站資料抓取測試 (`recent_data_test.dart`)

### 📋 測試概述
這個測試檔案專門驗證 AQI 應用程式中「最近3小時測站資料抓取」功能的正確性。

### 🧪 測試分類

#### 1. **3小時內資料篩選測試**
- **測試目標**: 驗證系統能正確篩選出最近3小時內的資料
- **測試案例**:
  - ✅ 正確篩選出最近3小時內的資料（3筆資料）
  - ✅ 當沒有3小時內資料時返回0筆
  - ✅ 正確計算3小時內資料的平均PM2.5值
  - ✅ 當只有1筆3小時內資料時正確處理

#### 2. **時間範圍格式化測試**
- **測試目標**: 驗證時間範圍的格式化功能
- **測試案例**:
  - ✅ 正確格式化3小時內資料的時間範圍
  - ✅ 當只有1筆資料時時間範圍顯示相同時間

#### 3. **邊界情況測試**
- **測試目標**: 驗證系統在邊界情況下的處理
- **測試案例**:
  - ✅ 正確處理剛好3小時的資料（不包含）
  - ✅ 正確處理空資料集
  - ✅ 正確處理PM2.5為0的資料

#### 4. **多站點資料測試**
- **測試目標**: 驗證多站點資料的處理邏輯
- **測試案例**:
  - ✅ 正確處理不同站點的資料，只包含指定站點且3小時內的資料

### 🔧 測試技術細節

#### 使用的測試框架
- **Flutter Test**: 主要測試框架
- **Mockito**: 用於模擬 AqiRepository
- **AAA 模式**: Arrange-Act-Assert 測試模式

#### 測試資料策略
- **動態時間**: 使用 `DateTime.now()` 確保測試資料在3小時內
- **多樣化場景**: 包含正常、邊界、異常等各種情況
- **真實資料結構**: 使用實際的 AqiRecord 模型

#### Mock 設定
```dart
@GenerateMocks([AqiRepository])
import 'recent_data_test.mocks.dart';

late MockAqiRepository mockRepo;
late AqiProvider provider;

setUp(() {
  mockRepo = MockAqiRepository();
  provider = AqiProvider(repository: mockRepo);
});
```

### 📊 測試覆蓋範圍

#### 功能覆蓋
- ✅ 資料篩選邏輯
- ✅ 時間計算邏輯
- ✅ 平均值計算
- ✅ 時間範圍格式化
- ✅ 錯誤處理

#### 邊界情況覆蓋
- ✅ 空資料集
- ✅ 單筆資料
- ✅ 剛好3小時的資料
- ✅ PM2.5為0的情況
- ✅ 多站點資料

### 🚀 運行測試

#### 運行特定測試檔案
```bash
flutter test test/features/aqi/recent_data_test.dart
```

#### 運行所有測試
```bash
flutter test
```

#### 生成測試覆蓋率報告
```bash
flutter test --coverage
genhtml coverage/lcov.info -o coverage/html
```

### 📈 測試結果

#### 成功指標
- **測試數量**: 10個測試案例
- **通過率**: 100%
- **覆蓋範圍**: 完整的3小時資料抓取功能

#### 驗證的功能
1. **資料篩選**: 正確識別3小時內的資料
2. **統計計算**: 準確計算資料筆數和平均值
3. **時間處理**: 正確格式化時間範圍
4. **錯誤處理**: 妥善處理各種異常情況

### 🔍 測試維護

#### 新增測試案例
當新增相關功能時，請在對應的測試群組中添加新的測試案例。

#### 更新測試資料
如果 AqiRecord 模型結構發生變化，請相應更新測試資料。

#### 保持測試獨立性
每個測試案例都應該是獨立的，不依賴其他測試的執行結果。

---

**最後更新**: 2024年12月
**測試檔案**: `recent_data_test.dart`
**相關功能**: AqiProvider 最近3小時資料功能 