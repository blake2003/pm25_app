# æ·±è‰²æ¨¡å¼æ¸¬è©¦æ–‡ä»¶èªªæ˜

## ğŸ“‹ æ¸¬è©¦æ–‡ä»¶æ¦‚è¿°

`darkmode_test.dart` æ˜¯æ ¹æ“š `darkmode.md` è¦ç¯„å‰µå»ºçš„å®Œæ•´æ¸¬è©¦æ–‡ä»¶ï¼Œæ¶µè“‹äº†æ·±è‰²æ¨¡å¼åˆ‡æ›åŠŸèƒ½çš„æ‰€æœ‰æ¸¬è©¦éœ€æ±‚ã€‚

## ğŸ¯ æ¸¬è©¦è¦†è“‹ç¯„åœ

### å–®å…ƒæ¸¬è©¦ (UT)
- **UT-001**: é è¨­å€¼æ¸¬è©¦ - é©—è­‰åˆå§‹åŒ–æ™‚ä½¿ç”¨ system é è¨­å€¼
- **UT-002**: æ·±è‰²æ¨¡å¼åˆ‡æ›æ¸¬è©¦
- **UT-003**: æ·ºè‰²æ¨¡å¼åˆ‡æ›æ¸¬è©¦  
- **UT-004**: è·Ÿéš¨ç³»çµ±æ¨¡å¼åˆ‡æ›æ¸¬è©¦
- **UT-005**: å„²å­˜/è®€å–æ¸¬è©¦ - é©—è­‰è¨­å®šæŒä¹…åŒ–
- **UT-006**: éŒ¯èª¤è™•ç†æ¸¬è©¦ - é©—è­‰ç„¡æ•ˆå€¼å›é€€æ©Ÿåˆ¶

### æ•´åˆæ¸¬è©¦ (IT)
- **IT-101**: UI é‡å»ºæ¸¬è©¦ - é©—è­‰ä¸»é¡Œåˆ‡æ›æ™‚ UI æ­£ç¢ºé‡å»º
- **IT-102**: æ•ˆèƒ½æ¸¬è©¦ - ç¢ºä¿ä¸»é¡Œåˆ‡æ›åœ¨ 100ms å…§å®Œæˆ
- **IT-103**: ç³»çµ±äº‹ä»¶æ¸¬è©¦ - é©—è­‰è·Ÿéš¨ç³»çµ±æ¨¡å¼éŸ¿æ‡‰
- **IT-104**: å¯ç”¨æ€§æ¸¬è©¦ - é©—è­‰ä¸‰ç¨®ä¸»é¡Œé¸é …çš„å¯ç”¨æ€§
- **IT-105**: å¯å­˜å–æ€§æ¸¬è©¦ - é©—è­‰å°æ¯”åº¦ç¬¦åˆ WCAG AA æ¨™æº–

### å ´æ™¯æ¸¬è©¦ (ST)
- **ST-201**: å•Ÿå‹•æµç¨‹æ¸¬è©¦ - é©—è­‰é‡å•Ÿå¾Œè¨­å®šä¿æŒ
- **ST-202**: ç©©å®šæ€§æ¸¬è©¦ - é©—è­‰é€£çºŒåˆ‡æ›çš„ç©©å®šæ€§

### é¡å¤–æ¸¬è©¦
- **ç‹€æ…‹è½‰ç§»æ¸¬è©¦**: é©—è­‰æ‰€æœ‰ä¸»é¡Œé–“çš„æ­£ç¢ºè½‰ç§»
- **ä¸»é¡Œè‰²å½©æ¸¬è©¦**: é©—è­‰æ·±è‰²å’Œæ·ºè‰²ä¸»é¡Œçš„è‰²å½©è¦ç¯„

## ğŸ—ï¸ æ¸¬è©¦æ¶æ§‹

### å‡è¨­çš„ ThemeProvider
```dart
class ThemeProvider extends ChangeNotifier {
  ThemeMode _themeMode = ThemeMode.system;
  DateTime _lastUpdated = DateTime.now();
  
  ThemeMode get themeMode => _themeMode;
  DateTime get lastUpdated => _lastUpdated;
  
  Future<void> loadTheme() async { /* å¾ Repository è®€å– */ }
  Future<void> toggleTheme(ThemeMode mode) async { /* åˆ‡æ›ä¸»é¡Œä¸¦å„²å­˜ */ }
  void setThemeForTesting(ThemeMode mode) { /* æ¸¬è©¦ç”¨æ–¹æ³• */ }
}
```

### æ¸¬è©¦è¼”åŠ©å‡½æ•¸
- `_calculateContrastRatio()`: è¨ˆç®—è‰²å½©å°æ¯”åº¦
- `_getRelativeLuminance()`: è¨ˆç®—ç›¸å°äº®åº¦
- `_getSRGBComponent()`: sRGB åˆ†é‡è½‰æ›

## ğŸš€ åŸ·è¡Œæ¸¬è©¦

### åŸ·è¡Œæ‰€æœ‰æ·±è‰²æ¨¡å¼æ¸¬è©¦
```bash
cd pm25_app
flutter test test/features/settings/darkmode_test.dart
```

### åŸ·è¡Œç‰¹å®šæ¸¬è©¦ç¾¤çµ„
```bash
# åŸ·è¡Œå–®å…ƒæ¸¬è©¦
flutter test test/features/settings/darkmode_test.dart --name="å–®å…ƒæ¸¬è©¦"

# åŸ·è¡Œæ•´åˆæ¸¬è©¦
flutter test test/features/settings/darkmode_test.dart --name="æ•´åˆæ¸¬è©¦"

# åŸ·è¡Œå ´æ™¯æ¸¬è©¦
flutter test test/features/settings/darkmode_test.dart --name="å ´æ™¯æ¸¬è©¦"
```

## ğŸ“Š æ¸¬è©¦çµæœé©—è­‰

### é æœŸæ¸¬è©¦çµæœ
- âœ… æ‰€æœ‰å–®å…ƒæ¸¬è©¦é€šé
- âœ… æ‰€æœ‰æ•´åˆæ¸¬è©¦é€šé
- âœ… æ‰€æœ‰å ´æ™¯æ¸¬è©¦é€šé
- âœ… æ•ˆèƒ½æ¸¬è©¦ç¬¦åˆè¦æ±‚ (< 100ms)
- âœ… å¯å­˜å–æ€§æ¸¬è©¦ç¬¦åˆ WCAG AA æ¨™æº–

### æ—¥èªŒè¼¸å‡º
æ¸¬è©¦æœƒè¼¸å‡ºè©³ç´°çš„æ—¥èªŒè³‡è¨Šï¼ŒåŒ…æ‹¬ï¼š
- æ¸¬è©¦é€šéç‹€æ…‹
- æ•ˆèƒ½æ•¸æ“š
- å°æ¯”åº¦æ•¸å€¼
- è‰²å½©è³‡è¨Š

## ğŸ”§ å¯¦éš›å¯¦ç¾æ™‚çš„ä¿®æ”¹

ç•¶å¯¦éš›å¯¦ç¾ ThemeProvider æ™‚ï¼Œéœ€è¦ï¼š

1. **æ›¿æ›å‡è¨­çš„ ThemeProvider**:
   ```dart
   // å°‡å‡è¨­çš„ ThemeProvider æ›¿æ›ç‚ºå¯¦éš›å¯¦ç¾
   import 'package:pm25_app/features/settings/theme_provider.dart';
   ```

2. **æ·»åŠ  SharedPreferences ä¾è³´**:
   ```dart
   // åœ¨ pubspec.yaml ä¸­æ·»åŠ 
   shared_preferences: ^2.2.2
   ```

3. **å¯¦ç¾ Repository å±¤**:
   ```dart
   // å‰µå»º ThemeRepository å°è£ SharedPreferences æ“ä½œ
   class ThemeRepository {
     Future<Map<String, dynamic>> loadThemeSettings() async { /* å¯¦ä½œ */ }
     Future<void> saveThemeSettings(Map<String, dynamic> settings) async { /* å¯¦ä½œ */ }
   }
   ```

4. **æ·»åŠ  Mock æ¸¬è©¦**:
   ```dart
   // ä½¿ç”¨ mockito é€²è¡Œ Repository æ¸¬è©¦
   @GenerateMocks([SharedPreferences])
   import 'theme_repository_test.mocks.dart';
   ```

## ğŸ“ æ¸¬è©¦ç¶­è­·

### æ–°å¢æ¸¬è©¦
ç•¶æ·»åŠ æ–°åŠŸèƒ½æ™‚ï¼Œè«‹ï¼š
1. åœ¨é©ç•¶çš„æ¸¬è©¦ç¾¤çµ„ä¸­æ·»åŠ æ–°æ¸¬è©¦
2. æ›´æ–°æ¸¬è©¦ ID ç·¨è™Ÿ
3. æ·»åŠ ç›¸æ‡‰çš„æ—¥èªŒè¼¸å‡º

### æ›´æ–°æ¸¬è©¦
ç•¶ä¿®æ”¹åŠŸèƒ½æ™‚ï¼Œè«‹ï¼š
1. æ›´æ–°å°æ‡‰çš„æ¸¬è©¦æ¡ˆä¾‹
2. ç¢ºä¿æ¸¬è©¦ä»ç„¶è¦†è“‹æ‰€æœ‰é‚Šç•Œæƒ…æ³
3. é©—è­‰æ¸¬è©¦çµæœ

## ğŸ¯ æ¸¬è©¦ç›®æ¨™

é€™å€‹æ¸¬è©¦æ–‡ä»¶ç¢ºä¿ï¼š
- âœ… åŠŸèƒ½æ­£ç¢ºæ€§ï¼šæ‰€æœ‰ä¸»é¡Œåˆ‡æ›åŠŸèƒ½æ­£å¸¸å·¥ä½œ
- âœ… è³‡æ–™æŒä¹…åŒ–ï¼šè¨­å®šæ­£ç¢ºå„²å­˜å’Œè®€å–
- âœ… UI éŸ¿æ‡‰æ€§ï¼šä¸»é¡Œåˆ‡æ›æ™‚ UI ç«‹å³æ›´æ–°
- âœ… æ•ˆèƒ½è¦æ±‚ï¼šåˆ‡æ›é€Ÿåº¦ç¬¦åˆè¦æ±‚
- âœ… ç©©å®šæ€§ï¼šé€£çºŒæ“ä½œä¸æœƒå‡ºç¾ç•°å¸¸
- âœ… å¯å­˜å–æ€§ï¼šç¬¦åˆç„¡éšœç¤™è¨­è¨ˆæ¨™æº–

---

**æœ€å¾Œæ›´æ–°**: 2025å¹´01æœˆ  
**ç‰ˆæœ¬**: 1.0.0  
**é©ç”¨ç¯„åœ**: PM25 æ‡‰ç”¨ç¨‹å¼æ·±è‰²æ¨¡å¼æ¸¬è©¦è¦ç¯„ 