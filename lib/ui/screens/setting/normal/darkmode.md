# æ·±æ·ºè‰²ä¸»é¡Œåˆ‡æ› é–‹ç™¼æµç¨‹èˆ‡è¦ç¯„

## ğŸš€ é–‹ç™¼æµç¨‹

### æµç¨‹åœ–
**flow chart TD**
  - A[App å•Ÿå‹•] --> B{æœ¬åœ°æ˜¯å¦æœ‰ä½¿ç”¨è€…ä¸»é¡Œè¨­å®š?}
  - B -- æœ‰ --> C[è®€å–åå¥½: light/dark/system]
  - B -- ç„¡ --> D[é è¨­: system]
  - C --> E[è¨­å®š ThemeProvider.themeMode]
  - D --> E
  - E --> F[ä»¥ themeMode å»ºç«‹ MaterialApp ä¸»é¡Œ]
  - F --> G[`è¨­å®šé ï¼šä½¿ç”¨è€…åˆ‡æ›ä¸»é¡Œ`]
  - G --> H[æ›´æ–° ThemeProvider.themeMode]
  - H --> I[ç«‹å³é‡å»º UIï¼ˆlisten/notifyListenersï¼‰]
  - I --> J[å¯«å…¥ SharedPreferences: themeMode]
  - J --> K[ï¼ˆ`ä¸‹æ¬¡å•Ÿå‹•æ²¿ç”¨è¨­å®š`ï¼‰]

### ç‹€æ…‹è½‰ç§»åœ–
**stateDiagram-v2**
  - [*] --> System
  - System --> Light: ä½¿ç”¨è€…é¸ã€Œæ·ºè‰²ã€
  - System --> Dark: ä½¿ç”¨è€…é¸ã€Œæ·±è‰²ã€
  - Light --> Dark: ä½¿ç”¨è€…é¸ã€Œæ·±è‰²ã€
  - Light --> System: ä½¿ç”¨è€…é¸ã€Œè·Ÿéš¨ç³»çµ±ã€
  - Dark --> Light: ä½¿ç”¨è€…é¸ã€Œæ·ºè‰²ã€
  - Dark --> System: ä½¿ç”¨è€…é¸ã€Œè·Ÿéš¨ç³»çµ±ã€

### æ¸¬è©¦è¦ç¯„å°ç…§è¡¨
**å‘½åè¦å‰‡**
- å–®å…ƒæ¸¬è©¦ IDï¼šUT-xxxï¼ˆprovider/å„²å­˜/è½‰æ›ï¼‰
- å°å‹æ•´åˆæ¸¬è©¦ IDï¼šIT-xxxï¼ˆWidget + Providerï¼‰
- ç«¯å°ç«¯/å ´æ™¯æ¸¬è©¦ IDï¼šST-xxxï¼ˆå•Ÿå‹•â†’åˆ‡æ›â†’é‡å•Ÿï¼‰

 | éœ€æ±‚ç·¨è™Ÿ | æ¸¬è©¦ ID   | é¡å‹         | å‰ç½®æ¢ä»¶ / Fixture                                   | æ¸¬è©¦æ­¥é©Ÿ (Steps)                        | æœŸæœ›çµæœ (Assert)                                 | è¦†è“‹é‡é»         |
  |----------|-----------|--------------|------------------------------------------------------|------------------------------------------|---------------------------------------------------|------------------|
  | R1       | UT-001    | Unit         | SharedPreferences ç‚ºç©º                               | loadTheme()                              | themeMode == ThemeMode.system                     | é è¨­å€¼           |
  | R2       | UT-002    | Unit         | å·²åˆå§‹åŒ– Provider                                    | toggleTheme(ThemeMode.dark)              | themeMode == ThemeMode.dark                       | ç‹€æ…‹è®Šæ›´         |
  |          | UT-003    | Unit         | åŒä¸Š                                                 | toggleTheme(ThemeMode.light)             | themeMode == ThemeMode.light                      | ç‹€æ…‹è®Šæ›´         |
  |          | UT-004    | Unit         | åŒä¸Š                                                 | toggleTheme(ThemeMode.system)            | themeMode == ThemeMode.system                     | ç‹€æ…‹è®Šæ›´         |
  | R3       | IT-101    | Integration  | åŒ…å« MaterialApp(themeMode: provider.themeMode) çš„æ¸¬è©¦ Widget | é»æ“Šã€Œæ·±è‰²æ¨¡å¼ã€é¸é …                     | find.byType(Icon/Color/Key(...dark...)) å­˜åœ¨      | UI é‡å»º          |
  | R4       | UT-005    | Unit         | åˆ‡åˆ° dark å¾Œæ–°å»º provider ä¸¦ loadTheme()             | è®€å–åå¥½                                 | æ–° provider çš„ themeMode == dark                  | å„²å­˜/è®€å–        |
  | R5       | ST-201    | Scenario     | é¦–æ¬¡åˆ‡ lightï¼Œæ¨¡æ“¬é‡å•Ÿï¼ˆæ£„èˆŠæ¨¹ï¼Œé‡å»º appï¼‰           | å†æ¬¡é€²å…¥ app                              | themeMode == lightï¼ŒUI ç‚ºæ·ºè‰²                     | å•Ÿå‹•æµç¨‹         |
  | R6       | UT-006    | Unit         | æ‰‹å‹•å¯«å…¥ themeMode=unknown                           | loadTheme()                              | themeMode == system                              | éŒ¯èª¤è™•ç†         |
  | R7       | IT-102    | Integration  | ä½¿ç”¨ Clock/FakeAsync                                 | è¨˜éŒ„ toggleTheme()â†’é¦–å€‹é‡å»ºå®Œæˆæ™‚é–“      | å°æ–¼ 100ms                                        | æ•ˆèƒ½             |
  | R8       | IT-103    | Integration  | æ¨¡æ“¬ MediaQuery.platformBrightness è®Šæ›´               | å°‡ app è¨­ç‚º systemï¼Œè®Šæ›´ç³»çµ±æ˜æš—         | UI è·Ÿè‘—æ”¹                                         | ç³»çµ±äº‹ä»¶         |
  | R9       | IT-104    | Integration  | è¨­å®šé æœ‰ä¸‰ç¨®é¸é …ï¼ˆlight/dark/systemï¼‰                | é€ä¸€é»æ“Šä¸‰é …ä¸¦è¿”å›                        | ç•«é¢ä¸»é¡Œèˆ‡é¸é …åŒæ­¥                                | å¯ç”¨æ€§           |
  | R10      | ST-202    | Scenario     | éš¨æ©Ÿé€£çºŒåˆ‡æ› 100 æ¬¡ï¼ˆfuzzï¼‰                          | ç›£è½ä¾‹å¤–/æ—¥èªŒ                             | ç„¡æœªæ•æ‰ä¾‹å¤–ã€ç„¡ frame drop æ˜é¡¯ç•°å¸¸               | ç©©å®šæ€§           |
  | R11      | IT-105    | Integration  | æä¾›æš—/æ·ºè‰²ä¸»é¡Œè‰²ç¥¨                                  | é©—è­‰ä¸»è¦æ–‡å­—/æŒ‰éˆ•/é€£çµå°æ¯”                | å°æ¯”åº¦é” WCAG AA                                  | å¯å­˜å–æ€§         |

  <!--
  è¨­è¨ˆé‚è¼¯èªªæ˜ï¼š
  - æœ¬è¡¨æ ¼ä¾æ“šéœ€æ±‚èˆ‡æ¸¬è©¦è¦ç¯„ï¼Œå°‡æ·±æ·ºè‰²ä¸»é¡Œåˆ‡æ›çš„æ‰€æœ‰æ ¸å¿ƒé©—è­‰é»ä»¥ã€Œéœ€æ±‚ç·¨è™Ÿã€æ¸¬è©¦IDã€é¡å‹ã€å‰ç½®æ¢ä»¶ã€æ­¥é©Ÿã€æœŸæœ›çµæœã€è¦†è“‹é‡é»ã€æ–¹å¼å®Œæ•´åˆ—å‡ºã€‚
  - æ¶µè“‹å–®å…ƒæ¸¬è©¦ã€æ•´åˆæ¸¬è©¦ã€æƒ…å¢ƒæ¸¬è©¦ï¼Œç¢ºä¿åŠŸèƒ½æ­£ç¢ºã€UIå³æ™‚åæ‡‰ã€è³‡æ–™æŒä¹…åŒ–ã€æ•ˆèƒ½ã€ç©©å®šæ€§èˆ‡å¯å­˜å–æ€§ã€‚
  - æ¯ä¸€é …æ¸¬è©¦çš†å°æ‡‰ä¸€å€‹æ˜ç¢ºçš„é©—è­‰ç›®æ¨™ï¼Œä¾¿æ–¼å¾ŒçºŒæ’°å¯«è‡ªå‹•åŒ–æ¸¬è©¦èˆ‡äººå·¥é©—è­‰ã€‚
  - è¡¨æ ¼å¯ç›´æ¥ç”¨æ–¼æ¸¬è©¦è¨ˆç•«ã€é–‹ç™¼è‡ªæŸ¥èˆ‡éœ€æ±‚è¿½è¹¤ã€‚
  -->
